{"version":3,"sources":["System/ResolverBase.ts"],"names":[],"mappings":"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","file":"ResolverBase.js","sourcesContent":["/*!\r\n * @author electricessence / https://github.com/electricessence/\r\n * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md\r\n */\r\n\r\nimport {DisposableBase} from \"./Disposable/DisposableBase\";\r\nimport {Func} from \"./FunctionTypes\";\r\nimport {ArgumentNullException} from \"./Exceptions/ArgumentNullException\";\r\nimport __extendsImport from \"../extends\";\r\n// noinspection JSUnusedLocalSymbols\r\nconst __extends = __extendsImport;\r\nconst NULL:any = null;\r\nconst NAME:string = \"ResolverBase\";\r\n\r\n/**\r\n * The ResolverBase class handles resolving a factory method and detects recursion.\r\n * Since JS does not have a synchronization mechanism (lock or otherwise)\r\n * we have to prevent getValue from double triggering the value factory (optimistic concurrency)\r\n * or returning return a value that is intermediate between resolving and resolved.\r\n */\r\nexport abstract class ResolverBase<T> extends DisposableBase\r\n{\r\n\r\n\tprotected _isValueCreated:boolean|null; // null = 'creating'\r\n\tprotected _value:T|null|undefined;\r\n\r\n\tprotected constructor(\r\n\t\tprotected _valueFactory:Func<T>,\r\n\t\tprivate readonly _trapExceptions:boolean,\r\n\t\tprivate readonly _allowReset:boolean = false)\r\n\t{\r\n\t\tsuper();\r\n\t\tthis._disposableObjectName = NAME;\r\n\t\tif(!_valueFactory) throw new ArgumentNullException(\"valueFactory\");\r\n\t\tthis._isValueCreated = false;\r\n\t}\r\n\r\n\tprotected _error:any;\r\n\r\n\tprotected getError():any\r\n\t{\r\n\t\treturn this._error;\r\n\t}\r\n\r\n\tget error():any\r\n\t{\r\n\t\treturn this.getError();\r\n\t}\r\n\r\n\tgetValue():T\r\n\t{\r\n\r\n\t\tconst _ = this;\r\n\t\t_.throwIfDisposed();\r\n\r\n\t\tif(_._isValueCreated===null)\r\n\t\t\tthrow new Error(\"Recursion detected.\");\r\n\r\n\t\tif(!_._isValueCreated && _._valueFactory)\r\n\t\t{\r\n\t\t\t_._isValueCreated = null; // Mark this as 'resolving'.\r\n\t\t\ttry\r\n\t\t\t{\r\n\t\t\t\tlet c:Func<T>;\r\n\t\t\t\tif(!_._isValueCreated && (c = _._valueFactory))\r\n\t\t\t\t{\r\n\t\t\t\t\t_._isValueCreated = null; // Mark this as 'resolving'.\r\n\t\t\t\t\tif(!this._allowReset) this._valueFactory = NULL;\r\n\t\t\t\t\tconst v = c();\r\n\t\t\t\t\t_._value = v;\r\n\t\t\t\t\t_._error = void 0;\r\n\t\t\t\t\treturn v;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tcatch(ex)\r\n\t\t\t{\r\n\t\t\t\t_._error = ex;\r\n\t\t\t\tif(!_._trapExceptions) throw ex;\r\n\t\t\t}\r\n\t\t\tfinally\r\n\t\t\t{\r\n\t\t\t\t_._isValueCreated = true;\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\r\n\t\treturn _._value!;\r\n\r\n\t}\r\n\r\n\tget canReset():boolean\r\n\t{\r\n\t\treturn this._allowReset && !!this._valueFactory;\r\n\t}\r\n\r\n\tprotected _onDispose():void\r\n\t{\r\n\t\tthis._valueFactory = NULL;\r\n\t\tthis._value = NULL;\r\n\t\tthis._isValueCreated = NULL;\r\n\t}\r\n\r\n\ttryReset():boolean\r\n\t{\r\n\t\tconst _ = this;\r\n\r\n\t\tif(!_._valueFactory)\r\n\t\t\treturn false;\r\n\t\telse\r\n\t\t{\r\n\t\t\t_._isValueCreated = false;\r\n\t\t\t_._value = NULL;\r\n\t\t\t_._error = void 0;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nexport default ResolverBase;"]}